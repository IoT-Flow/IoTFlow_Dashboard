<!DOCTYPE html>
<html>

<head>
  <title>IoTFlow Login Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }

    .test-section {
      background: #f5f5f5;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }

    .success {
      color: green;
    }

    .error {
      color: red;
    }

    button {
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
    }

    pre {
      background: #eee;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>

<body>
  <h1>IoTFlow Dashboard Login Test</h1>

  <div class="test-section">
    <h2>Test Demo Login</h2>
    <p>Demo credentials:</p>
    <ul>
      <li><strong>Admin:</strong> admin@iotflow.com / admin123</li>
      <li><strong>John:</strong> john@iotflow.com / john123</li>
      <li><strong>Alice:</strong> alice@iotflow.com / alice123</li>
    </ul>

    <button onclick="clearStorage()">Clear LocalStorage</button>
    <button onclick="testDemoLogin()">Test Demo Login</button>
    <button onclick="checkAuthState()">Check Auth State</button>

    <div id="results"></div>
  </div>

  <script>
    function clearStorage() {
      localStorage.clear();
      updateResults('LocalStorage cleared successfully', 'success');
    }

    function testDemoLogin() {
      // Simulate the demo login process
      const demoUser = {
        id: 2,
        username: 'john',
        email: 'john@iotflow.com',
        firstName: 'John',
        lastName: 'Smith',
        role: 'user',
        api_key: 'john_api_key_demo_secure_token_456',
        tenant_id: 2,
        permissions: ['device_access', 'telemetry_read'],
        createdAt: new Date(Date.now() - 86400000 * 15).toISOString(),
        lastLogin: new Date().toISOString()
      };

      try {
        localStorage.setItem('iotflow_user', JSON.stringify(demoUser));
        localStorage.setItem('iotflow_user_api_key', demoUser.api_key);
        localStorage.removeItem('iotflow_devices_cache');

        updateResults('Demo login simulation successful!', 'success');
      } catch (error) {
        updateResults('Demo login simulation failed: ' + error.message, 'error');
      }
    }

    function checkAuthState() {
      try {
        const userApiKey = localStorage.getItem('iotflow_user_api_key');
        const userData = localStorage.getItem('iotflow_user');

        if (!userApiKey || !userData) {
          updateResults('No authentication data found', 'error');
          return;
        }

        const parsedUser = JSON.parse(userData);

        if (!parsedUser.id || !parsedUser.email) {
          updateResults('Invalid user data structure', 'error');
          return;
        }

        const result = `
Authentication Check Results:
✓ API Key: ${userApiKey ? 'Present' : 'Missing'}
✓ User Data: ${userData ? 'Present' : 'Missing'}
✓ User ID: ${parsedUser.id}
✓ Email: ${parsedUser.email}
✓ Username: ${parsedUser.username}
✓ Role: ${parsedUser.role}
✓ First Name: ${parsedUser.firstName}
✓ Last Name: ${parsedUser.lastName}
✓ Tenant ID: ${parsedUser.tenant_id}
✓ Last Login: ${parsedUser.lastLogin}
                `;

        updateResults(result, 'success');
      } catch (error) {
        updateResults('Auth check failed: ' + error.message, 'error');
      }
    }

    function updateResults(message, type) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<pre class="${type}">${message}</pre>`;
    }

    // Check initial state
    window.onload = function () {
      checkAuthState();
    };
  </script>
</body>

</html>